apiVersion: pxc.percona.com/v1
kind: PerconaXtraDBCluster
metadata:
  name: percona
spec:
  crVersion: 1.17.0
  secretsName: percona
  allowUnsafeConfigurations: true
  upgradeOptions:
    apply: disabled
    schedule: "0 4 * * *"
  initContainer:
    image: perconalab/percona-xtradb-cluster-operator:main-pxc8.0
  pxc:
    size: 3
    image: perconalab/percona-xtradb-cluster-operator:main-pxc8.0
    nodeSelector: &nodeSelector
      kubernetes.io/arch: amd64
    volumeSpec:
      persistentVolumeClaim:
        storageClassName: ceph-block
        resources:
          requests:
            storage: 50Gi 
  haproxy:
    enabled: true
    size: 1
    image: perconalab/percona-xtradb-cluster-operator:main-haproxy
    nodeSelector: *nodeSelector
  logcollector:
    enabled: true
    image: perconalab/percona-xtradb-cluster-operator:1.16.1-logcollector-fluentbit3.2.2
  backup:
    image: perconalab/percona-xtradb-cluster-operator:1.16.1-pxc8.0-backup-pxb8.0.35
    storages:
      s3:
        type: s3
        nodeSelector: *nodeSelector
        s3:
          bucket: percona-backup
          region: us-east-1
          credentialsSecret: percona-s3
          endpointUrl: http://minio:9000
    schedule:
      - name: "daily-backup"
        schedule: "0 0 * * *"
        keep: 30
        storageName: s3
